{"version":3,"file":"single-spa.js","sources":["../../src/start.js","../../src/navigations/reroute.js","../../src/applications/app.helper.js","../../src/applications/app.js"],"sourcesContent":["import { reroute } from \"./navigations/reroute\";\n\nexport let started = false;\nexport function start() {\n  started = true;\n  reroute(); // 加载与挂载应用\n}\n","import { getAppChanges } from \"../applications/app\";\nimport { started } from \"../start\";\n\nexport function reroute() {\n  const { appsToLoad, appsToMount, appsToUnmount } = getAppChanges();\n\n  console.log(appsToLoad, appsToMount, appsToUnmount);\n\n  if (started) {\n    // start: 进行应用挂载\n    return preformAppChanges(); // 根据路径来装载应用\n  } else {\n    // register: 进行应用加载\n    return loadApps(); // 预先加载应用\n  }\n}\n\n/**\n * 加载应用\n */\nasync function loadApps() {}\n\n/**\n * 根据路径来装载应用\n */\nasync function preformAppChanges() {}\n","// 描述应用的整个状态\nexport const NOT_LOADED = \"NOT_LOADED\"; // 应用初始状态（没有加载过）\nexport const LOADING_SOURCE_CODE = \"LOADING_SOURCE_CODE\"; // 加载资源\nexport const NOT_BOOTSTRAPPED = \"NOT_BOOTSTRAPPED\"; // 启动前\nexport const BOOTSTRAPPING = \"BOOTSTRAPPING\"; // 启动中\nexport const NOT_MOUNTED = \"NOT_MOUNTED\"; // 挂载前\nexport const MOUNTING = \"MOUNTING\"; // 挂载中\nexport const MOUNTED = \"MOUNTED\"; // 挂载完毕\nexport const UPDATING = \"UPDATING\"; // 更新中\nexport const UNMOUNTING = \"UNMOUNTING\"; // 卸载中\nexport const UNLOADING = \"UNLOADING\"; // 没有加载中\nexport const LOAD_ERROR = \"LOAD_ERROR\"; // 加载失败\nexport const SKIP_BECAUSE_BROKEN = \"SKIP_BECAUSE_BROKEN\"; // 运行出错\n\n/**\n * 判断当前应用是否处于激活状态\n * @param {*} app 应用\n * @returns\n */\nexport function isActive(app) {\n  return app.status === MOUNTED;\n}\n\n/**\n * 判断当前应用是否需要被激活（即判断当前是否处于activeWhen）\n * @param {*} app 应用\n */\nexport function shouldBeActive(app) {\n  return app.activeWhen(window.location);\n}\n","import { reroute } from \"../navigations/reroute\";\nimport {\n  BOOTSTRAPPING,\n  LOADING_SOURCE_CODE,\n  MOUNTED,\n  NOT_BOOTSTRAPPED,\n  NOT_LOADED,\n  NOT_MOUNTED,\n  SKIP_BECAUSE_BROKEN,\n  shouldBeActive,\n} from \"./app.helper\";\n\nconst apps = []; // 用来存放所有应用\n\n/**\n * 注册应用\n * @param {*} appName 应用名称\n * @param {*} loadApp 加载的应用\n * @param {*} activeWhen 当激活时会调用loadApp\n * @param {*} customProps 自定义属性（用于全局通信）\n */\nexport function registerApplication(appName, loadApp, activeWhen, customProps) {\n  apps.push({\n    // 存储应用\n    name: appName,\n    loadApp,\n    activeWhen,\n    customProps,\n    status: NOT_LOADED,\n  });\n\n  reroute(); // 加载应用\n}\n\n/**\n * 根据应用的状态来进行筛选，判断哪些应用是加载还是装载的\n */\nexport function getAppChanges() {\n  const appsToUnmount = []; // 要卸载的应用\n  const appsToLoad = []; // 要加载的应用\n  const appsToMount = []; // 要挂载的应用\n\n  apps.forEach((app) => {\n    // 根据当前hash判断是否被激活\n    const appShouldBeActive =\n      app.status !== SKIP_BECAUSE_BROKEN && shouldBeActive(app);\n    switch (app.status) {\n      case NOT_LOADED:\n      case LOADING_SOURCE_CODE:\n        if (appShouldBeActive) {\n          appsToLoad.push(app);\n        }\n        break;\n      case NOT_BOOTSTRAPPED:\n      case BOOTSTRAPPING:\n      case NOT_MOUNTED:\n        if (appShouldBeActive) {\n          appsToMount.push(app);\n        }\n        break;\n      case MOUNTED:\n        if (!appShouldBeActive) {\n          appsToUnmount.push(app);\n        }\n    }\n  });\n\n  return { appsToLoad, appsToUnmount, appsToMount };\n}\n"],"names":[],"mappings":"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"}